!function(t,a){t.fn.teamCityBuildStatus=function(t){return this.each(function(){new n(this,t)})};var n=function(t,a){function n(){u.getAll(function(t){t.forEach(d.create)})}var c=new e(t,a),u=new i(a),d=new s(c,a);n()},e=function(a,n){function e(){var e=t("<div>").addClass("title").text(n.projectName);return t("<div>").attr("id",n.projectId).addClass(i).addClass("failed").append(e).appendTo(a)}var i="project",s=e(),c=[];this.hasFailed=function(t){s.prop("class",i).addClass("failed"),-1===c.indexOf(t)&&c.push(t)},this.hasPassed=function(t){var a=c.indexOf(t);-1!==a&&(c.splice(a,1),0===c.length&&s.prop("class",i).addClass("success"))},this.showBuild=function(t){s.append(t)}},i=function(a){var n="/guestAuth/app/rest/projects/id:";this.getAll=function(e){t.ajax({url:a.teamcityUrl+n+a.projectId,headers:{accept:"application/json"},success:function(t){e(t.buildTypes.buildType)}})}},s=function(t,a){this.create=function(n){return new c(t,{teamcityUrl:a.teamcityUrl,id:n.id,name:n.name,refreshTimeout:a.refreshTimeout,branch:a.branch})}},c=function(a,n){function e(){i(),s(),n.refreshTimeout&&setInterval(s,n.refreshTimeout)}function i(){var e=t("<span>").addClass("name").text(n.name);u=t("<div>").attr("id",n.id).addClass(d).append(e),a.showBuild(u)}function s(){t.ajax({url:l,headers:{accept:"application/json"},success:function(t){t.build.length>0&&c(t.build[0])}})}function c(t){u.prop("class",d).addClass(o[t.status]).toggleClass("running",!!t.running),"FAILURE"===t.status?a.hasFailed(n.id):a.hasPassed(n.id)}var u,d="build-stage",r=n.branch?"branch:name:"+n.branch+",":"",l=n.teamcityUrl+"/guestAuth/app/rest/builds?locator="+r+"buildType:(id:"+n.id+"),lookupLimit:10,running:any",o={FAILURE:"failed",SUCCESS:"success"};e()}}(jQuery);