!function(t){t.fn.teamCityBuildStatus=function(t){return this.each(function(){new e(this,t)})};var e=function(t,e){function i(){c.getAll(function(t){t.forEach(d.create)})}var u=new n(t,e),c=new s(e),d=new a(u,e);i()},n=function(e,n){function s(){var s=t("<div>").addClass("title").text(n.projectName);return t("<div>").attr("id",n.projectId).addClass(a).addClass("success").append(s).appendTo(e)}var a="project",i=s(),u=[];this.hasFailed=function(t){i.prop("class",a).addClass("failed"),-1===u.indexOf(t)&&u.push(t)},this.hasPassed=function(t){var e=u.indexOf(t);-1!==e&&(u.splice(e,1),0===u.length&&i.prop("class",a).addClass("success"))},this.showBuild=function(t){i.append(t)}},s=function(e){var n="/guestAuth/app/rest/projects/id:";this.getAll=function(s){t.ajax({url:e.teamcityUrl+n+e.projectId,headers:{accept:"application/json"},success:function(t){s(t.buildTypes.buildType)}})}},a=function(t,e){this.create=function(n){return new i(t,{teamcityUrl:e.teamcityUrl,id:n.id,name:n.name,refreshTimeout:e.refreshTimeout})}},i=function(e,n){function s(){a(),i(),n.refreshTimeout&&setInterval(i,n.refreshTimeout)}function a(){var s=t("<span>").addClass("name").text(n.name);c=t("<div>").attr("id",n.id).addClass(d).append(s),e.showBuild(c)}function i(){t.ajax({url:r,headers:{accept:"application/json"},success:function(t){t.build.length>0&&u(t.build[0])}})}function u(t){c.prop("class",d).addClass(o[t.status]).toggleClass("running",!!t.running),"FAILURE"===t.status?e.hasFailed(n.id):e.hasPassed(n.id)}var c,d="build-stage",r=n.teamcityUrl+"/guestAuth/app/rest/builds?locator=buildType:(id:"+n.id+"),lookupLimit:10,running:any",o={FAILURE:"failed",SUCCESS:"success"};s()}}(jQuery);