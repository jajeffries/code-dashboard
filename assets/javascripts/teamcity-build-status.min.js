!function(t){t.fn.teamCityBuildStatus=function(t){return this.each(function(){new n(this,t)})};var n=function(t,n){function a(){c.getAll(function(t){t.forEach(d.create)})}var u=new s(t,n),c=new e(n),d=new i(u,n);a()},s=function(n,s){function e(){return t("<div>").attr("id",s.projectId).addClass(i).addClass("success").appendTo(n)}var i="project",a=e(),u=[];this.hasFailed=function(t){a.prop("class",i).addClass("failed"),-1===u.indexOf(t)&&u.push(t)},this.hasPassed=function(t){var n=u.indexOf(t);-1!==n&&(u.splice(n,1),0===u.length&&a.prop("class",i).addClass("success"))},this.showBuild=function(t){a.append(t)}},e=function(n){var s="/guestAuth/app/rest/projects/id:";this.getAll=function(e){t.ajax({url:n.teamcityUrl+s+n.projectId,headers:{accept:"application/json"},success:function(t){e(t.buildTypes.buildType)}})}},i=function(t,n){this.create=function(s){return new a(t,{teamcityUrl:n.teamcityUrl,id:s.id,name:s.name,refreshTimeout:n.refreshTimeout})}},a=function(n,s){function e(){i(),a(),s.refreshTimeout&&setInterval(a,s.refreshTimeout)}function i(){var e=t("<span>").addClass("name").text(s.name);c=t("<div>").attr("id",s.id).addClass(d).append(e),n.showBuild(c)}function a(){t.ajax({url:r,headers:{accept:"application/json"},success:function(t){t.build.length>0&&u(t.build[0])}})}function u(t){c.prop("class",d).addClass(o[t.status]).toggleClass("running",!!t.running),"FAILURE"===t.status?n.hasFailed(s.id):n.hasPassed(s.id)}var c,d="build-stage",r=s.teamcityUrl+"/guestAuth/app/rest/builds?locator=buildType:(id:"+s.id+"),lookupLimit:10,running:any",o={FAILURE:"failed",SUCCESS:"success"};e()}}(jQuery);