!function(t){t.fn.teamCityBuildStatus=function(t){return this.each(function(){new n(this,t)})};var n=function(t,n){function i(){u.getAll(function(t){t.forEach(r.create)})}var c=new a(t,n),u=new e(n),r=new s(c,n);i()},a=function(n,a){function e(){var e=t("<div>").addClass("title").text(a.projectName);return t("<div>").attr("id",a.projectId).addClass(s).addClass("success").append(e).appendTo(n)}var s="project",i=e(),c=[];this.hasFailed=function(t){i.prop("class",s).addClass("failed"),-1===c.indexOf(t)&&c.push(t)},this.hasPassed=function(t){var n=c.indexOf(t);-1!==n&&(c.splice(n,1),0===c.length&&i.prop("class",s).addClass("success"))},this.showBuild=function(t){i.append(t)}},e=function(n){var a="/guestAuth/app/rest/projects/id:";this.getAll=function(e){t.ajax({url:n.teamcityUrl+a+n.projectId,headers:{accept:"application/json"},success:function(t){e(t.buildTypes.buildType)}})}},s=function(t,n){this.create=function(a){return new i(t,{teamcityUrl:n.teamcityUrl,id:a.id,name:a.name,refreshTimeout:n.refreshTimeout,branch:n.branch})}},i=function(n,a){function e(){s(),i(),a.refreshTimeout&&setInterval(i,a.refreshTimeout)}function s(){var e=t("<span>").addClass("name").text(a.name);u=t("<div>").attr("id",a.id).addClass(r).append(e),n.showBuild(u)}function i(){t.ajax({url:o,headers:{accept:"application/json"},success:function(t){t.build.length>0&&c(t.build[0])}})}function c(t){u.prop("class",r).addClass(l[t.status]).toggleClass("running",!!t.running),"FAILURE"===t.status?n.hasFailed(a.id):n.hasPassed(a.id)}var u,r="build-stage",d=a.branch?"branch:name:"+a.branch+",":"",o=a.teamcityUrl+"/guestAuth/app/rest/builds?locator="+d+"buildType:(id:"+a.id+"),lookupLimit:10,running:any",l={FAILURE:"failed",SUCCESS:"success"};e()}}(jQuery);