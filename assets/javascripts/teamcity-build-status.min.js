!function(t,e){t.fn.teamCityBuildStatus=function(t){return this.each(function(){new n(this,t)})};var n=function(t,e){function n(){r.getAll(function(t){t.forEach(d.create)})}var c=new a(t,e),r=new i(e),d=new s(c,e);n()},a=function(e,n){var a="project",i=[],s=t(e),c=s.find("[data-project]"),r=c.find("[data-title]"),d="http://teamcity.dev/project.html?projectId="+n.projectId+"&tab=projectOverview";c.attr("id",n.projectId).addClass(a).addClass("failed"),r.text(n.projectName),r.on("click",function(){window.open(d)}),this.hasFailed=function(t){c.prop("class",a).addClass("failed"),-1===i.indexOf(t)&&i.push(t)},this.hasPassed=function(t){var e=i.indexOf(t);-1!==e&&i.splice(e,1),0===i.length&&c.prop("class",a).addClass("success")},this.showBuild=function(t){c.append(t)}},i=function(e){var n="/guestAuth/app/rest/projects/id:";this.getAll=function(a){t.ajax({url:e.teamcityUrl+n+e.projectId,headers:{accept:"application/json"},success:function(t){a(t.buildTypes.buildType)}})}},s=function(t,e){this.create=function(n){return new c(t,{teamcityUrl:e.teamcityUrl,id:n.id,name:n.name,refreshTimeout:e.refreshTimeout,branch:e.branch})}},c=function(e,n){function a(){i(),s(),n.refreshTimeout&&setInterval(s,n.refreshTimeout)}function i(){var a=t("<span>").addClass("name").text(n.name);r=t("<div>").attr("id",n.id).addClass(d).append(a),e.showBuild(r)}function s(){t.ajax({url:o,headers:{accept:"application/json"},success:function(t){t.build.length>0&&c(t.build[0])}})}function c(t){r.prop("class",d).addClass(l[t.status]).toggleClass("running",!!t.running),"FAILURE"===t.status?e.hasFailed(n.id):e.hasPassed(n.id)}var r,d="build-stage",u=n.branch?"branch:name:"+n.branch+",":"",o=n.teamcityUrl+"/guestAuth/app/rest/builds?locator="+u+"buildType:(id:"+n.id+"),lookupLimit:10,running:any",l={FAILURE:"failed",SUCCESS:"success"};a()}}(jQuery);